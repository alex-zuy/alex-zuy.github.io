



<!DOCTYPE html>
<html>
    <head>
        <script src="http://code.jquery.com/jquery-2.2.0.min.js"></script>
        <script>
            jQuery(function($) {
    function responsiveTable(tableSelector) {
        var table = $(tableSelector);
        var allHighlightableCells = table.find('td.highlightable');
        var firstColumnCells = table.find('td:first-child');
        table.find('td.cell').click(function(e) {
            allHighlightableCells.removeClass('highlighted');
            firstColumnCells.removeClass('dependency');
            var td = $(e.target);
            var clickedColumn = td.index() + 1;
            var clickedRow = td.parent().index() + 1;
            var cellsInRowOrColumn =
                'td.highlightable:nth-child(' + clickedColumn + '),tr:nth-child(' + clickedRow + ')>td.highlightable';
            table.find(cellsInRowOrColumn).addClass('highlighted');
            var depenencyMethodInFirstColumn = 'tr:nth-child(' + clickedColumn + ')>td:first-child';
            table.find(depenencyMethodInFirstColumn).addClass('dependency');
        });
    }

    function setUpTableDimensions(tableSelector) {
        var table = $(tableSelector);
        var maxWidth = table.find('.horizontal-heading td')
            .get()
            .map(function(elem) {
                return $(elem).width();
            })
            .sort(function(l, r) {
                return parseInt(l) - parseInt(r);
            })
            .pop();
        table.find('.horizontal-heading td').css('maxWidth', '30px');
        table.find('tr.horizontal-heading>td').css('height', maxWidth);
    }

    var tableSelector = '#matrixTable';
    setUpTableDimensions(tableSelector);
    responsiveTable(tableSelector);
});
        </script>
        <style>
            #matrixTable {
    margin-top: 20px;
}
.horizontal-heading td .rotated {
    margin-bottom: 7px;
    position: relative;
    -webkit-transform: rotate(-90deg);
    -moz-transform: rotate(-90deg);
    -ms-transform: rotate(-90deg);
    -o-transform: rotate(-90deg);
    transform: rotate(-90deg);
}
.horizontal-heading td {
    vertical-align: bottom;
}
.diagonal {
    background-color: darkgray !important;
}
.depends-on {
    background-color: red !important;
}
table {
    border-collapse: collapse;
}
td.cell {
    text-align: center;
    border: solid 2px black
}
td[data-accessibility=PUBLIC] {
    color: green;
}
td[data-accessibility=PROTECTED] {
    color: yellow;
}
td[data-accessibility=PRIVATE] {
    color: black;
}
td[data-accessibility=DEFAULT] {
    color: blue;
}
td[data-static=true] {
    background-color: #D0D0D0;
}
.centered {
    margin-left: auto;
    margin-right: auto;
}
.highlightable.highlighted {
    background-color: yellow;
}
.highlightable.dependency {
    background-color: #D09CDC;
}
        </style>
    </head>
    <body>
        <table id="matrixTable" class="centered">
            <thead></thead>
            <tbody>
                <tr class="horizontal-heading">
                    <td></td>
                                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                            <div class="rotated">
                                setExpectedClassNameRegex(String)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                            <div class="rotated">
                                setClassAnnotationNameRegex(String)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                            <div class="rotated">
                                setMethodAnnotationNameRegex(String)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                            <div class="rotated">
                                getDefaultTokens()
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                            <div class="rotated">
                                visitToken(DetailAST)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                            <div class="rotated">
                                isClassDefinitionAnnotated(DetailAST)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                            <div class="rotated">
                                isAtleastOneMethodAnnotated(DetailAST)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                            <div class="rotated">
                                hasUnexpectedName(DetailAST)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                            <div class="rotated">
                                hasAnnotation(DetailAST,Pattern)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                            <div class="rotated">
                                logUnexpectedClassName(DetailAST)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PRIVATE" data-static="true">
                            <div class="rotated">
                                getIdentifierName(DetailAST)
                            </div>
                        </td>
                                            <td class="highlightable" data-accessibility="PRIVATE" data-static="true">
                            <div class="rotated">
                                isMatchesRegex(Pattern,String)
                            </div>
                        </td>
                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                                setExpectedClassNameRegex(String)
                            </td>
                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                                setClassAnnotationNameRegex(String)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                                setMethodAnnotationNameRegex(String)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                                getDefaultTokens()
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PUBLIC" data-static="false">
                                visitToken(DetailAST)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell depends-on">0</td>
                                                                                                                                <td class="highlightable cell depends-on">1</td>
                                                                                                                                <td class="highlightable cell depends-on">2</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell depends-on">4</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                                isClassDefinitionAnnotated(DetailAST)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell depends-on">2</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                                isAtleastOneMethodAnnotated(DetailAST)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell depends-on">1</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                                hasUnexpectedName(DetailAST)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell depends-on">2</td>
                                                                                                                                <td class="highlightable cell depends-on">3</td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                                hasAnnotation(DetailAST,Pattern)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell depends-on">1</td>
                                                                                                                                <td class="highlightable cell depends-on">2</td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PRIVATE" data-static="false">
                                logUnexpectedClassName(DetailAST)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PRIVATE" data-static="true">
                                getIdentifierName(DetailAST)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                    </tr>
                                            <tr>
                            <td class="highlightable" data-accessibility="PRIVATE" data-static="true">
                                isMatchesRegex(Pattern,String)
                            </td>
                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell"></td>
                                                                                                                                <td class="highlightable cell diagonal">-</td>
                                                                                    </tr>
                                </tbody>
        </table>
        <div class="centered">
            In the matrix above, methods situated in the order they appear
            in class definition(first method occupies first row and first column,
            second method occupies second row and second column an so on). Text color
            indicates accessibility of methods in the following way:
            <ul>
                <li>public - GREEN</li>
                <li>protected - yellow</li>
                <li>private - black</li>
                <li>default - blue</li>
            </ul>
            Grey background color indicates that method is static.
        </div>
        <p>
            If some method depends on another method(by calling it), then matrix
            cell situated at intersection of caller`s row and callee`s column is displayed
            in red and number in this cell indicates distance between methods.
            Diagonal cells are always displayed in grey.
        </p>
        <h4>Source file</h4>
        <!-- Library -->
        <link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />
        <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
        <script src="http://alexgorbatchev.com/pub/sh/current/scripts/shAutoloader.js" type="text/javascript"></script>
        <script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js"></script>
        <!-- Source code -->
        <script type="syntaxhighlighter" class="brush: java"><![CDATA[////////////////////////////////////////////////////////////////////////////////
// checkstyle: Checks Java source code for adherence to a set of rules.
// Copyright(C) 2001-2012  Oliver Burn
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
////////////////////////////////////////////////////////////////////////////////

package com.github.sevntu.checkstyle.checks.coding;

import java.util.regex.Pattern;

import com.puppycrawl.tools.checkstyle.api.Check;
import com.puppycrawl.tools.checkstyle.api.DetailAST;
import com.puppycrawl.tools.checkstyle.api.TokenTypes;

/**
 * <p>
 * This check verifies the name of JUnit4 test class for compliance with user
 * defined naming convention(by default Check expects test classes names
 * matching
 * ".+Test\\d*|.+Tests\\d*|Test.+|Tests.+|.+IT|.+ITs|.+TestCase\\d*|.+TestCases\\d*"
 * regex).
 * </p>
 * <p>
 * Class is considered to be a test if its definition or one of its method
 * definitions annotated with user defined annotations. By default Check looks
 * for classes which contain methods annotated with "Test" or "org.junit.Test".
 * </p>
 * <p>
 * Check has following options:
 * </p>
 * <p>
 * "expectedClassNameRegex" - regular expression which matches expected test
 * class names. If test class name does not matches this regex then Check will
 * log violation. This option defaults to
 * ".+Test\\d*|.+Tests\\d*|Test.+|Tests.+|.+IT|.+ITs|.+TestCase\\d*|.+TestCases\\d*".
 * </p>
 * <p>
 * "classAnnotationNameRegex" - regular expression which matches test annotation
 * names on classes. If class annotated with matching annotation, it is
 * considered to be a test. This option defaults to empty regex(one that matches
 * nothing). If for example this option set to "RunWith", then class "SomeClass"
 * is considered to be a test:
 * 
 * <pre>
 * <code>
 * {@literal @}RunWith(Parameterized.class)
 * class SomeClass
 * {
 * }
 * </code>
 * </pre>
 * 
 * </p>
 * <p>
 * "methodAnnotationNameRegex" - regular expression which matches test
 * annotation names on methods. If class contains a method annotated with
 * matching annotation, it is considered to be a test. This option defaults to
 * "Test|org.junit.Test". For example, if this option set to "Test", then class
 * "SomeClass" is considered to be a test.
 * 
 * <pre>
 * <code>
 * class SomeClass
 * {
 *      {@literal @}Test
 *      void method() {
 *      
 *      }
 * }
 * </code>
 * </pre>
 * 
 * </p>
 * <p>
 * Annotation names must be specified exactly the same way it specified in code,
 * thus if Check must match annotation with fully qualified name, corresponding
 * options must contain qualified annotation name and vice versa. For example,
 * if annotation regex is "org.junit.Test" Check will recognize "{@literal @}
 * org.junit.Test" annotation and will skip "{@literal @}Test" annotation and
 * vice versa if annotation regex is "Test" Check will recognize "{@literal @}
 * Test" annotation and skip "{@literal @}org.junit.Test" annotation.
 * </p>
 * <p>
 * Following configuration will adjust Check to look for classes annotated with
 * annotation "RunWith" or classes with methods annotated with "Test" and verify
 * that classes names end with "Test" or "Tests".
 * 
 * <pre>
 *     &ltmodule name="NameConventionForJUnit4TestClassesCheck"&gt
 *       &ltproperty name="expectedClassNameRegex" value=".+Tests|.+Test"/&gt
 *       &ltproperty name="classAnnotationNameRegex" value="RunWith"/&gt
 *       &ltproperty name="methodAnnotationNameRegex" value="Test"/&gt
 *     &lt/module&gt
 * </pre>
 * </p>
 * 
 * @author <a href="mailto:zuy_alexey@mail.ru">Zuy Alexey</a>
 */
public class NameConventionForJunit4TestClassesCheck extends Check
{
    /**
     * Violation message key.
     */
    public static final String MSG_KEY = "name.convention.for.test.classes";

    /**
     * <p>
     * Regular expression which matches expected names of JUnit test classes.
     * </p>
     * <p>
     * Default value is
     * ".+Test\\d*|.+Tests\\d*|Test.+|Tests.+|.+IT|.+ITs|.+TestCase\\d*|.+TestCases\\d*".
     * </p>
     */
    private Pattern expectedClassNameRegex =
            Pattern.compile(".+Test\\d*|.+Tests\\d*|Test.+|Tests.+|.+IT|.+ITs|.+TestCase\\d*|.+TestCases\\d*");

    /**
     * <p>
     * Regular expression which matches JUnit class test annotation names.
     * </p>
     * <p>
     * By default this regex is empty.
     * </p>
     */
    private Pattern classAnnotationNameRegex;

    /**
     * <p>
     * Regular expression which matches JUnit method test annotation names.
     * </p>
     * <p>
     * Default value is "Test|org.junit.Test".
     * </p>
     */
    private Pattern methodAnnotationNameRegex =
            Pattern.compile("Test|org.junit.Test");

    /**
     * Sets regexp to match 'expected' class names for JUnit tests.
     * @param expectedClassNameRegex
     *        regexp to match 'correct' JUnit test class names.
     */
    public void setExpectedClassNameRegex(String expectedClassNameRegex)
    {
        if (expectedClassNameRegex != null && !expectedClassNameRegex.isEmpty()) {
            this.expectedClassNameRegex = Pattern.compile(expectedClassNameRegex);
        }
        else {
            this.expectedClassNameRegex = null;
        }
    }

    /**
     * Sets class test annotation name regexp for JUnit tests.
     * @param annotationNameRegex
     *        regexp to match annotations for unit test classes.
     */
    public void setClassAnnotationNameRegex(String annotationNameRegex)
    {
        if (annotationNameRegex != null && !annotationNameRegex.isEmpty()) {
            classAnnotationNameRegex = Pattern.compile(annotationNameRegex);
        }
        else {
            classAnnotationNameRegex = null;
        }
    }

    /**
     * Sets method test annotation name regexp for JUnit tests.
     * @param annotationNameRegex
     *        regexp to match annotations for unit test classes.
     */
    public void setMethodAnnotationNameRegex(String annotationNameRegex)
    {
        if (annotationNameRegex != null && !annotationNameRegex.isEmpty()) {
            methodAnnotationNameRegex = Pattern.compile(annotationNameRegex);
        }
        else {
            methodAnnotationNameRegex = null;
        }
    }

    @Override
    public int[] getDefaultTokens()
    {
        return new int[] { TokenTypes.CLASS_DEF };
    }

    @Override
    public void visitToken(DetailAST classDefNode)
    {
        if ((isClassDefinitionAnnotated(classDefNode) || isAtleastOneMethodAnnotated(classDefNode))
                && hasUnexpectedName(classDefNode)) {
            logUnexpectedClassName(classDefNode);
        }
    }

    /**
     * Checks whether class definition annotated with user defined annotation.
     * @param classDefNode
     *        a class definition node
     * @return true, if class definition annotated with user defined annotation
     */
    private boolean isClassDefinitionAnnotated(DetailAST classDefNode)
    {
        return hasAnnotation(classDefNode, classAnnotationNameRegex);
    }

    /**
     * Checks whether class contains at least one method annotated with user
     * defined annotation.
     * @param classDefNode
     *        a class definition node
     * @return true, if class contains at least one method annotated with user
     *         defined annotation
     */
    private boolean isAtleastOneMethodAnnotated(DetailAST classDefNode)
    {
        DetailAST classMemberNode =
                classDefNode.findFirstToken(TokenTypes.OBJBLOCK).getFirstChild();

        while (classMemberNode != null) {
            if (classMemberNode.getType() == TokenTypes.METHOD_DEF &&
                    hasAnnotation(classMemberNode, methodAnnotationNameRegex))
            {
                return true;
            }

            classMemberNode = classMemberNode.getNextSibling();
        }

        return false;
    }

    /**
     * Returns true, if class has unexpected name.
     * @param classDefNode
     *        a class definition node
     * @return true, if class has unexpected name
     */
    private boolean hasUnexpectedName(final DetailAST classDefNode)
    {
        final String className = getIdentifierName(classDefNode);
        return !isMatchesRegex(expectedClassNameRegex, className);
    }

    /**
     * Returns true, if class or method has annotation with name specified in
     * regexp.
     * @param methodOrClassDefNode
     *        the node of type TokenTypes.METHOD_DEF or TokenTypes.CLASS_DEF
     * @param annotationNamesRegexp
     *        regexp contains annotation names
     * @return true, if the class or method contains one of the annotations,
     *         specified in the regexp
     */
    private boolean hasAnnotation(DetailAST methodOrClassDefNode, Pattern annotationNamesRegexp)
    {
        DetailAST modifierNode =
                methodOrClassDefNode.findFirstToken(TokenTypes.MODIFIERS).getFirstChild();

        boolean result = false;

        while (modifierNode != null) {
            if (modifierNode.getType() == TokenTypes.ANNOTATION) {
                String annotationName = getIdentifierName(modifierNode);

                if (isMatchesRegex(annotationNamesRegexp, annotationName)) {
                    result = true;
                    break;
                }
            }

            modifierNode = modifierNode.getNextSibling();
        }

        return result;
    }

    /**
     * Logs unexpected class name.
     * @param classDef
     *        the node of type TokenTypes.CLASS_DEF
     */
    private void logUnexpectedClassName(DetailAST classDef)
    {
        log(classDef.findFirstToken(TokenTypes.IDENT), MSG_KEY, expectedClassNameRegex);
    }

    /**
     * Returns name of identifier contained in specified node.
     * @param aNodeWithIdent
     *        a node containing identifier or qualified identifier.
     * @return identifier name for specified node. If node contains qualified
     *         name then method returns its text representation.
     */
    private static String getIdentifierName(DetailAST identifierNode)
    {
        DetailAST identNode = identifierNode.findFirstToken(TokenTypes.IDENT);
        String result;

        if (identNode != null) {
            result = identNode.getText();
        }
        else {
            result = "";

            DetailAST node = identifierNode.findFirstToken(TokenTypes.DOT);

            while (node.getType() == TokenTypes.DOT) {
                result = "." + node.getLastChild().getText() + result;

                node = node.getFirstChild();
            }

            result = node.getText() + result;
        }

        return result;
    }

    /**
     * Matches string against regexp.
     * @param regexPattern
     *        regex to match string with. May be null.
     * @param str
     *        a string to match against regex.
     * @return false if regex is null, otherwise result of matching string
     *         against regex.
     */
    private static boolean isMatchesRegex(Pattern regexPattern, String str)
    {
        if (regexPattern != null) {
            return regexPattern.matcher(str).matches();
        }
        else {
            return false;
        }
    }
}]]></script>
        <script type="text/javascript">
            SyntaxHighlighter.all()
        </script>
    </body>
</html>
